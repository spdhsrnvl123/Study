import { createTodo } from "@/api/create-todo";
import { Query_KEYS } from "@/lib/constants";
import type { Todo } from "@/types";
import { useMutation, useQueries, useQueryClient } from "@tanstack/react-query";

export function useCreateTodoMutation() {
  const queryClient = useQueryClient(); //캐시무효화 위해 필요
  //queryClient는 저장소 같은 개념

  return useMutation({
    mutationFn: createTodo,
    onMutate: () => {
      console.log("호출 직후");
    },
    onSettled: () => {
      console.log("완료");
    },
    onSuccess: (newTodo) => { //createTodo함수에 반환값은 onSuccess에 인자(newTodo)로 받아올 수 있다. 그리고 타입추론까지 할 수 있다. 
      //그렇기 때문에 굳이 invalidateQueryies로 캐시무효화를 해서 리페칭할 필요없다.
      // queryClient.invalidateQueries({queryKey: Query_KEYS.todo.list}) //캐시무효화
      // setQueryData에 첫번째 인수에는 수정할 키값을 넣어주면된다.
      queryClient.setQueryData<Todo[]>(Query_KEYS.todo.list, (prevTodos)=>{
        if(!prevTodos) return [newTodo];
        return [...prevTodos, newTodo];
      })
    },
    onError: (error) => {
      window.alert("할 일 추가 중 오류가 발생했습니다: " + error);
    },
  });
}

onSuccess에 인자값을 활용해서


낙관적 업데이트
데이터 수정 요청이 성공할 것이라 낙관
요청을 보내자마자 데이터 업데이트
좋아요나 채팅처럼 빠른 반응을 제공하는 SNS에 주로 사용함
즉, 데이터 받는거를 성공하기도 전에 그냥 성공할 거라고 가정하고 하트를 채우거나 비워서 사용자에게 빠른 응답을 제공하고 있는
방법을 낙관적 업데이트라고 부른다.
그렇기 때문에 사용자들에게 빠른 기능을 제공할 수 있다.



